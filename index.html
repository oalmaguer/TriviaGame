<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Trivia</title>
  </head>
  <body>
    <div class="container container-yellow">
      <div class="row">
        <div class="col-12 triviaTitle text-center">
          <div class="content">
            <h1 class="display-3 text-center">Trivia Game</h1>
            <h2 class="questionAsked"></h2>
            <h2 class="timer"></h2>
            <div class="answers">
              <h3 id="answer1"></h3>
              <h3 id="answer2"></h3>
              <h3 id="answer3"></h3>
              <h3 id="answer4"></h3>
            </div>
          </div>
          <div class="btnDiv">
            <button class="btn btn-dark text-center">Start</button>
          </div>
          
        </div>
      </div>
    </div>
    <script>
      // render div
      $(document).ready(function() {
       

        let queryURL =
          "https://opentdb.com/api.php?amount=50&type=multiple";
        // lower the margin bottom of button
        $(".btn").on("click", function() {
          $(".btn").hide();
        
          var questionCounter = 0;
          var score = 0;
          $.ajax({
            url: queryURL,
            method: "GET"
          }).then(function(response) {
            
            questionAnswer();
            btnRepeat();
            count();
            

            function questionAnswer() {
              randomNumber = Math.floor(Math.random() * 50);
              console.log(response);
              console.log(randomNumber);
              var result = response.results[randomNumber].question;
              for (let i = 0; i < 3; i++) {
                var wrongAnswers =
                  response.results[randomNumber].incorrect_answers[i];
                var correctAnswer =
                  response.results[randomNumber].correct_answer;
                var myJSON2 = JSON.stringify(wrongAnswers);
                var myJSON3 = JSON.stringify(correctAnswer);
                console.log(myJSON3);

                var correct = "correct";
                var incorrect = "incorrect";
                var score = 0;
                var questionCounter = 0;

                var random1 = $(".answers").append(
                  '<input type="radio" name="rbtnCount" value=' +
                    incorrect +
                    ">" +
                    myJSON2 +
                    "</br>"
                );
              }

              randomNumber2 = Math.floor(Math.random() * 2 +1);
              if (randomNumber2 == "2") {
                var random2 =  $(".answers").append(
                '<input type="radio" name="rbtnCount" value=' +
                  correct +
                  ">" +
                  myJSON3 +
                  "</br>"
              );
              } else {
                var random2 =  $(".answers").prepend(
                '<input type="radio" name="rbtnCount" value=' +
                  correct +
                  ">" +
                  myJSON3 +
                  "</br>"
              );
              }
              var radioBtn = $('<input type="radio" name="rbtnCount" />');

              var myJSON = JSON.stringify(result);
              console.log(result);
              console.log(myJSON2);
              $(".questionAsked").append("<h1>" + myJSON + "</h1>");

              $(".answers").append(
                "<br>" + "<button>" + "Submit Answer" + "</button>"
              );

              $("button:first").addClass("answerBtn");
            }

            function btnRepeat() {
              $(".answerBtn").on("click", function() {
                
               
                let answerValue = $(
                  ".answers [name='rbtnCount']:checked"
                ).val();
                console.log(answerValue);
                if (answerValue == "correct") {
                  stop();
                  count();
                  score++;
                  questionCounter++;
                  $(".questionAsked").empty();
                  $(".answers").empty();
                  $("button:first").empty();
                  if (questionCounter == "5") {
                      stop();
                      alert("Finish");
                      $(".questionAsked").text("Congratulations");
                      $(".answers").append("You have " +score+" right answers");
                      $(".answers").append($('<img>',{id:'theImg',src:'../TriviaGame/assets/images/theoffice.gif'}))

                  } else {
                  console.log(questionCounter);
                  
                  console.log("question number "+questionCounter);
                  questionAnswer();
                  btnRepeat();
                  }
                } else  {
                  stop();
                  count();
                  questionCounter++;
                  $(".questionAsked").empty();
                  $(".answers").empty();
                  $("button:first").empty();
                  if (questionCounter == "5") {
                        stop();
                      alert("Finish");
                      $(".questionAsked").text("Congratulations");
                      $(".answers").text("You have " +score+" right answers");
                      $(".answers").append($('<img>',{id:'theImg',src:'../TriviaGame/assets/images/theoffice.gif'}))

                  } else {
                  console.log(questionCounter);
                  
                  console.log("question number "+questionCounter);
                  questionAnswer();
                  btnRepeat();
                  }
                } 
              });
            }

            var counter;
            function count() {
              counter = setTimeout(function() {
                alert("Times up, next question");
                questionCounter++;
                stop();
                count();
                $(".questionAsked").empty();
                $(".answers").empty();
                $("button:first").empty();
                $(".answers").append("<h4>Score " + score + "</h4");
                questionAnswer();
                btnRepeat();
              }, 10000); // end function
            }
            
            function stop() {
              clearTimeout(counter);
            
        }

            

           
          }); //end of ajax request
        });
      });


      // dont repeat the same question
      // when 7 questions have passed show result and new text
      //click clear
      //render question
    </script>
  </body>
</html>
